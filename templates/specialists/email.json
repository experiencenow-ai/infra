{
  "name": "email",
  "domain": "Email protocols (SMTP/IMAP) and reliable delivery",
  "created_by": "system",
  "created_at": "2025-01-15T00:00:00Z",
  "version": 1,
  "knowledge": "SMTP (Simple Mail Transfer Protocol):\n- Port 587: submission with STARTTLS (recommended)\n- Port 465: SMTPS (implicit TLS)\n- Port 25: relay only, often blocked\n\nIMAP (Internet Message Access Protocol):\n- Port 993: IMAPS (implicit TLS)\n- Port 143: IMAP with STARTTLS\n- Keeps mail on server, syncs state\n\nReliable delivery patterns:\n- Exponential backoff: delay = base * 2^attempt\n- Jitter: add random 0-10% to prevent thundering herd\n- Max retries: typically 3-5\n- Circuit breaker: stop trying after N consecutive failures\n\nCommon errors:\n- 421: Service not available (retry later)\n- 450: Mailbox unavailable (retry later)\n- 550: Mailbox not found (don't retry)\n- 552: Message too large (don't retry)\n- Connection refused: server down or wrong port\n- SSL errors: cert mismatch or expired",
  "examples": "# Retry with exponential backoff\nimport time\nimport random\n\ndef send_with_retry(msg, max_retries=3):\n    base_delay = 1.0\n    for attempt in range(max_retries):\n        try:\n            smtp.send_message(msg)\n            return True\n        except smtplib.SMTPServerDisconnected:\n            # Connection lost, reconnect and retry\n            smtp.connect()\n            smtp.login(user, password)\n        except smtplib.SMTPResponseException as e:\n            if e.smtp_code >= 500:\n                raise  # Permanent error, don't retry\n        # Exponential backoff with jitter\n        delay = base_delay * (2 ** attempt)\n        jitter = delay * random.uniform(0, 0.1)\n        time.sleep(delay + jitter)\n    return False\n\n# IMAP connection with keepalive\nimport imaplib\n\ndef check_mail_safe(imap):\n    try:\n        imap.noop()  # Keepalive\n        return imap.search(None, 'UNSEEN')\n    except imaplib.IMAP4.abort:\n        # Reconnect\n        imap = imaplib.IMAP4_SSL(host, port)\n        imap.login(user, password)\n        imap.select('INBOX')\n        return imap.search(None, 'UNSEEN')",
  "patterns": "- Always use TLS (port 587 or 993)\n- Implement retry for transient errors (4xx)\n- Don't retry permanent errors (5xx)\n- Add jitter to backoff delays\n- Use NOOP for keepalive on long connections\n- Log all send attempts with message IDs\n- Deduplicate received messages by Message-ID header"
}
